<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kumoh.cosmoa.mapper.CourseMapper">
    <select id="getCourseList" resultType="com.kumoh.cosmoa.dto.CourseDTO">
        SELECT  ID,
                NAME,
                DESCRIPTION,
                CREATED_DATE,
                MODIFIED_DATE,
                USER_ID
        FROM COURSE
    </select>

    <!-- 여행 코스 목록 조회 (번호, 제목, 좋아요수, 작성자 닉네임)-->
    <select id="getCourseResponseList" resultType="com.kumoh.cosmoa.dto.CourseResponseDTO">
        SELECT
                c.ID,
                c.NAME,
                u.NICKNAME,
                (select count(*) from COURSE_LIKE cl  WHERE cl.COURSE_ID = c.ID) AS `LIKE`
        FROM COURSE c, USER u
        WHERE c.USER_ID = u.ID
    </select>
    <!-- 코스생성 -->
    <insert id="createCourse" parameterType="com.kumoh.cosmoa.dto.CourseDTO" useGeneratedKeys="true"
    keyProperty="id">
    	INSERT INTO COURSE(
     					ID,
               			NAME,
                		DESCRIPTION,
                		CREATED_DATE,
                		MODIFIED_DATE,
                		USER_ID)
     	VALUES(#{id}, #{name}, #{description}, NOW(), NOW(), #{userId})
    </insert>
    
    <!-- 코스삭제 -->
    <delete id="deleteCourse" parameterType="int">
    	DELETE FROM COURSE WHERE ID = #{id}
    </delete>
    
    <!-- 코스수정 -->
    <update id="updateCourse" parameterType="com.kumoh.cosmoa.dto.CourseDTO">
    	UPDATE COURSE SET ID = #{id},
    					NAME = #{name},
    					DESCRIPTION = #{description},
    					MODIFIED_DATE = NOW()
    				WHERE ID = #{id}
    </update>
    
</mapper>